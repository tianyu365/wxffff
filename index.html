<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="renderer" content="webkit">
    <meta name="layoutmode" content="standard">
    <meta name="imagemode" content="force">
    <meta name="wap-font-scale" content="no">
    <meta name="format-detection" content="telephone=no">
    <title>网页嵌入器</title>
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="网页嵌入器">
    <meta property="og:description" content="通过识别码快速嵌入任何网页">
    <meta property="og:image" content="">
    
    <link rel="shortcut icon" href="" type="image/x-icon">
    <style>
        *{margin:0;padding:0;border:0}
        body,html{min-height:100%;background:#f8f8f8;font-family:Arial,sans-serif}
        body{overflow:hidden}
        iframe{width:100%;height:100vh;border:none}
        .error-content{color:red;font-size:18px;text-align:center;padding:50px;background:#fff;margin:20px;border-radius:10px}
        .loading{text-align:center;padding:50px;color:#666;background:#fff;margin:20px;border-radius:10px}
        .loading-spinner{display:inline-block;width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #3498db;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:20px}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        .loading-text{font-size:18px;color:#666;margin-top:20px}
    </style>
</head>
<body>
    <div id="content">
        <div class="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">正在加载网页...</div>
        </div>
    </div>
    
    <script>
        // API配置 - 使用本地HTTPS代理解决混合内容问题
        const API_BASE_URL = 'https://tianyu365.github.io/wxffff/proxy.html';
        
        // 获取URL参数
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }
        
        // 显示加载动画
        function showLoading() {
            document.getElementById('content').innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">正在加载网页...</div>
                </div>
            `;
        }
        
        // 显示错误信息
        function showError(message) {
            document.getElementById('content').innerHTML = `
                <div class="error-content">
                    <h3>❌ 加载失败</h3>
                    <p>${message}</p>
                    <button onclick="location.reload()" style="margin-top:20px;padding:10px 20px;background:#007cba;color:white;border:none;border-radius:5px;cursor:pointer;">重试</button>
                </div>
            `;
        }
        
        // 显示嵌入网页
        function showEmbeddedPage(url) {
            const iframe = document.createElement('iframe');
            iframe.src = url;
            iframe.style.width = '100%';
            iframe.style.height = '100vh';
            iframe.style.border = 'none';
            
            // 替换加载内容
            document.getElementById('content').innerHTML = '';
            document.getElementById('content').appendChild(iframe);
            
            // 处理加载错误
            iframe.onerror = function() {
                showError('网页加载失败，请检查目标网站是否可访问');
            };
        }
        
        // 从API获取嵌入信息
        async function fetchEmbedInfo(embedId) {
            try {
                const response = await fetch(`${API_BASE_URL}?action=get_embed&id=${embedId}`);
                const data = await response.json();
                
                if (data.success) {
                    return data.data.target_url;
                } else {
                    throw new Error(data.error || '获取嵌入信息失败');
                }
            } catch (error) {
                throw new Error('网络请求失败: ' + error.message);
            }
        }
        
        // 主函数
        async function init() {
            const embedId = getUrlParameter('i');
            
            if (embedId) {
                try {
                    // 显示3秒加载动画
                    showLoading();
                    
                    // 等待3秒
                    await new Promise(resolve => setTimeout(resolve, 3000));
                    
                    // 从API获取目标URL
                    const targetUrl = await fetchEmbedInfo(embedId);
                    
                    // 显示嵌入的网页
                    showEmbeddedPage(targetUrl);
                    
                } catch (error) {
                    showError(error.message);
                }
            } else {
                // 没有参数时显示使用说明
                document.getElementById('content').innerHTML = `
                    <div style="text-align:center;padding:50px;background:#fff;margin:20px;border-radius:10px;">
                        <h2>🌐 网页嵌入器</h2>
                        <p>使用方法：在URL后添加 ?i=识别码</p>
                        <p>例如：${window.location.href}?i=abc12345</p>
                        <p>这样就会嵌入对应的网页</p>
                        <br>
                        <p style="color:#666;font-size:14px;">
                            请先在管理后台创建嵌入记录，获取识别码后使用
                        </p>
                    </div>
                `;
            }
        }
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
